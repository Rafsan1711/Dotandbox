<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dot & Box Game - Firebase</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #0d0d0d;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }
    .card {
      background: #1e1e1e;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(255,255,255,0.05);
      width: 90%;
      max-width: 400px;
      text-align: center;
    }
    button {
      background: #2196f3;
      color: white;
      padding: 10px 20px;
      margin: 10px 0;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    input {
      padding: 10px;
      width: 100%;
      margin: 10px 0;
      border-radius: 5px;
      border: none;
    }
    #userDisplay {
      margin-bottom: 20px;
      background: #333;
      padding: 10px;
      border-radius: 10px;
    }
  </style>
</head>
<body>

<div class="card" id="loginCard">
  <h2>Dot & Box</h2>
  <p>Sign in to play with others online</p>
  <button onclick="signInWithGoogle()">Sign in with Google</button>
  <button onclick="continueAsGuest()">Continue as Guest</button>
</div>

<div class="card" id="homeScreen" style="display: none;">
  <div id="userDisplay"></div>
  <button onclick="createRoom()">Create Game</button>
  <input type="text" id="roomIdInput" placeholder="Enter Room ID">
  <button onclick="joinRoom()">Join Game</button>
</div>

<script>
  // ðŸ”¥ Your Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCuVAVqed3tw43XykpnKIq3gUmhbOQ8mfg",
  authDomain: "dot-and-box-6c3cb.firebaseapp.com",
  projectId: "dot-and-box-6c3cb",
  storageBucket: "dot-and-box-6c3cb.firebasestorage.app",
  messagingSenderId: "130733002450",
  appId: "1:130733002450:web:2fc8bee6aee8033577a70b"
};

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  let currentUser = {
    uid: '',
    name: '',
    guest: false
  };

  function signInWithGoogle() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).then(result => {
      const user = result.user;
      currentUser.uid = user.uid;
      currentUser.name = user.displayName;
      currentUser.guest = false;
      showHomeScreen();
    });
  }

  function continueAsGuest() {
    const guestId = 'guest_' + Math.random().toString(36).substr(2, 5);
    currentUser.uid = guestId;
    currentUser.name = 'Guest';
    currentUser.guest = true;
    showHomeScreen();
  }

  function showHomeScreen() {
    document.getElementById("loginCard").style.display = "none";
    document.getElementById("homeScreen").style.display = "block";
    document.getElementById("userDisplay").innerText = `Logged in as: ${currentUser.name}`;
  }

  function createRoom() {
    const roomId = Math.random().toString(36).substr(2, 6).toUpperCase();
    const roomRef = db.ref('rooms/' + roomId);
    roomRef.set({
      player1: currentUser,
      createdAt: Date.now()
    }).then(() => {
      alert("Room Created! Room ID: " + roomId);
      // Later: redirect to game.html?room=ROOMID
    });
  }

  function joinRoom() {
    const roomId = document.getElementById("roomIdInput").value.trim().toUpperCase();
    if (!roomId) return alert("Enter a valid Room ID");
    const roomRef = db.ref('rooms/' + roomId);
    roomRef.once('value').then(snapshot => {
      if (snapshot.exists()) {
        const roomData = snapshot.val();
        if (!roomData.player2) {
          roomRef.update({ player2: currentUser }).then(() => {
            alert("Joined Room: " + roomId);
            // Later: redirect to game.html?room=ROOMID
          });
        } else {
          alert("Room already full.");
        }
      } else {
        alert("Room not found.");
      }
    });
  }
</script>

</body>
</html>
